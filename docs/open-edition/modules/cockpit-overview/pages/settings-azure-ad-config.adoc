= Configure Azure AD bearer authentication

In this topic you learn how to set up authentication via Azure AD and how to configure it in your cockpit.
You must accomplish different tasks to enable the connection.

== Prerequisites

* You have registered the _DXP - Open Edition_ in the Azure portal.
Find more information about how to register an app on https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app[microsoft.com].
* You have created a xref:security-certificates-generate.adoc[self-signed certificate].
//links into another repository

== Procedure
=== Add a redirect URI
. In the Azure portal, go to *Authentication*.
. In *Redirect URI*, add one or more URIs.
These URIs will be accepted as destinations when returning authentication responses (tokens) after authenticating users.
+
[NOTE]
====
The redirect URI must have the following format:

`\https://<Planet 9 URL>/public/azure_redirect.html`

For example

`\https://planet9explored.neptune-software.com:8081/public/redirect.html`
====
// Replace Planet 9 with something else?
//ToDo rethink formatting
+
image::settings-azure-add-uri.png[,800]


=== Add a certificate and get a password

. In the Azure portal, go to *Certificates & secrets*.
. Click *Upload certificates* to upload the self-signed certificate you created in the _DXP - Open Edition_ Cockpit.
. Click *New client secret* to generate an application password.
Copy this password and save it for later use.
+
image::settings-add-certificate.png[,800]

=== Add API Permissions
. In the Azure portal, go to *API permissions*.
. Click *Add a permission* to configure a permission.
// Input needed
+
image::settings-set-api-permission.png[,800]
//ToDo make sure that the shown azure ad gui is up to date

== Add Azure AD authentication provider in the DXP Open Edition

. In the _DXP - Open Edition_ cockpit, go to *Settings*, and click *System Settings*.
. Click the *Authentication* tab.
. Click *Edit*.
. Click *Add*, and select *Azure AD*.
+
image::settings-auth-azure-ad.png[,800]
*Result*: The Authentication window opens.

=== Azure ID bearer
Fill in or check the following fields:

Name:: Enter a name for the authentication.
Active:: Check to activate this authentication method.
Show on Login page:: Check to show it on the _DXP Open Edition_ Session Login Page.
// "it" means Login screen?
Description:: Enter a description.
Path:: Enter a path to retrieve a _DXP Open Edition_ session (for example, open-edition-ad-bearer). You can add any string as a path.
//What does it mean?
Identity Metadata:: Enter a link to a metadata document that contains information required for an app to sign-in.
----
https://login.microsoftonline.com/<tenantid>/v2.0/.well-known/openid-configuration
----
//input needed
Tenant ID:: From your Azure AD account, enter the tenant ID for your _Neptune DXP - Open Edition_.
// Add prerequisite: Have the tenant ID from the Azure Portal for your _Neptune DXP - Open Edition_ ready
Client ID:: Enter your application's client ID from the Azure portal.
Client Secret:: Enter the client secret key that you generated in *New client secret* in the Azure portal.
Additional Scopes (Login request will use profile, openid, offline_access and User.Read)::
Use silent signout in PWA::
Use MSAl v2. Can be accessed in Launchpad with APPCacheLogonAzure.msalObj:: tba

=== Claims assignment
. Click *Add* to add a claims assignment.

=== Auto assignment
Assign Role:: Select the  roles that you want to assign ...
//where do you create these roles?
Assign Departments:: Select departments that you want to assign ...
//see above. Input needed

=== Custom Script
Enter your code here.

. Click *OK* to save your input.
*Result*: The Authentication window closes.
. In *System Settings*, click *Restart* to activate Azure AD authentication.

== Result
You have configured Azure AD authentication, and you have activated it.

== Related topics
* xref:settings-system.adoc[System Settings]

